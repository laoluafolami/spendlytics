@tailwind base;
@tailwind components;
@tailwind utilities;

/* ===== BASE LAYER - Mobile-First Foundation ===== */
@layer base {
  /* Remove tap highlight on all elements */
  * {
    -webkit-tap-highlight-color: transparent;
    -webkit-touch-callout: none;
  }

  /* Root element optimizations */
  :root {
    --safe-area-top: env(safe-area-inset-top, 0px);
    --safe-area-bottom: env(safe-area-inset-bottom, 0px);
    --safe-area-left: env(safe-area-inset-left, 0px);
    --safe-area-right: env(safe-area-inset-right, 0px);
    --bottom-nav-height: 64px;
    --header-height: 64px;

    /* Dynamic viewport height for mobile */
    --vh: 1vh;
  }

  html {
    touch-action: manipulation;
    scroll-behavior: smooth;
    -webkit-text-size-adjust: 100%;
    text-size-adjust: 100%;
    overflow-x: hidden;
  }

  body {
    margin: 0;
    padding: 0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue',
      Arial, sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    overscroll-behavior-x: none;
    overflow-x: hidden;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    background: linear-gradient(135deg, #eef2ff 0%, #faf5ff 50%, #fdf2f8 100%);
    min-height: 100vh;
    min-height: -webkit-fill-available;
    min-height: calc(var(--vh, 1vh) * 100);
  }

  body.dark {
    background: linear-gradient(135deg, #111827 0%, #1f2937 50%, #0f172a 100%);
  }

  #root {
    min-height: 100vh;
    min-height: -webkit-fill-available;
    min-height: calc(var(--vh, 1vh) * 100);
    padding-left: var(--safe-area-left);
    padding-right: var(--safe-area-right);
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }

  /* Interactive elements - proper touch targets */
  button, a, input[type="button"], input[type="submit"], [role="button"] {
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
    cursor: pointer;
  }

  /* Prevent zoom on iOS for input fields */
  input, textarea, select {
    font-size: 16px !important;
    touch-action: manipulation;
  }

  /* Better focus states for accessibility */
  *:focus-visible {
    outline: 2px solid #3B82F6;
    outline-offset: 2px;
  }

  /* Improve scrollbar styling */
  ::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }

  ::-webkit-scrollbar-track {
    background: transparent;
  }

  ::-webkit-scrollbar-thumb {
    background: rgba(156, 163, 175, 0.4);
    border-radius: 3px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: rgba(156, 163, 175, 0.6);
  }

  /* Hide scrollbar on mobile for cleaner look */
  @media (max-width: 768px) {
    ::-webkit-scrollbar {
      display: none;
    }

    * {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
  }

  /* Selection color */
  ::selection {
    background: rgba(59, 130, 246, 0.3);
    color: inherit;
  }
}

/* ===== COMPONENT LAYER ===== */
@layer components {
  /* Glass morphism card */
  .glass-card {
    @apply bg-white/60 dark:bg-gray-800/60 backdrop-blur-xl border border-white/20 dark:border-gray-700/50 rounded-2xl shadow-xl;
  }

  /* Mobile-optimized button */
  .btn-mobile {
    @apply min-h-[44px] min-w-[44px] px-4 py-3 rounded-xl font-semibold transition-all active:scale-95;
  }

  /* Mobile input field */
  .input-mobile {
    @apply w-full px-4 py-3 min-h-[48px] text-base bg-white/50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all;
  }

  /* Mobile-first card */
  .card-mobile {
    @apply p-4 sm:p-6 rounded-2xl bg-white/60 dark:bg-gray-800/60 backdrop-blur-xl border border-white/20 dark:border-gray-700/50;
  }

  /* Bottom sheet style modal */
  .bottom-sheet {
    @apply fixed inset-x-0 bottom-0 z-50 rounded-t-3xl bg-white dark:bg-gray-800 shadow-2xl;
    padding-bottom: max(16px, var(--safe-area-bottom));
    max-height: calc(100vh - var(--safe-area-top) - 40px);
    max-height: calc(var(--vh, 1vh) * 100 - var(--safe-area-top) - 40px);
  }

  /* Pull indicator for bottom sheets */
  .pull-indicator {
    @apply w-10 h-1 bg-gray-300 dark:bg-gray-600 rounded-full mx-auto mt-2 mb-4;
  }

  /* Mobile navigation item */
  .nav-item-mobile {
    @apply flex flex-col items-center justify-center gap-1 py-2 px-3 min-w-[64px] min-h-[56px] rounded-xl transition-all active:scale-95;
  }

  /* FAB (Floating Action Button) */
  .fab {
    @apply fixed z-40 w-14 h-14 rounded-full shadow-lg flex items-center justify-center transition-all active:scale-95;
    right: max(16px, var(--safe-area-right));
    bottom: calc(80px + var(--safe-area-bottom));
  }

  /* Mobile header */
  .header-mobile {
    @apply sticky top-0 z-30 backdrop-blur-xl bg-white/80 dark:bg-gray-900/80 border-b border-gray-200/50 dark:border-gray-700/50;
    padding-top: var(--safe-area-top);
  }

  /* Bottom navigation */
  .bottom-nav {
    @apply fixed bottom-0 left-0 right-0 z-40 backdrop-blur-xl bg-white/90 dark:bg-gray-900/90 border-t border-gray-200/50 dark:border-gray-700/50;
    padding-bottom: var(--safe-area-bottom);
    padding-left: var(--safe-area-left);
    padding-right: var(--safe-area-right);
    height: calc(var(--bottom-nav-height) + var(--safe-area-bottom));
  }

  /* Content area with bottom nav padding */
  .content-with-nav {
    padding-bottom: calc(var(--bottom-nav-height) + var(--safe-area-bottom) + 16px);
  }

  /* Swipeable area indicator */
  .swipe-hint {
    @apply absolute left-0 top-1/2 -translate-y-1/2 w-1 h-16 bg-gray-300/50 dark:bg-gray-600/50 rounded-r-full;
  }
}

/* ===== UTILITIES LAYER ===== */
@layer utilities {
  /* ===== ANIMATIONS ===== */
  .animate-fade-in {
    animation: fadeIn 0.4s ease-out;
  }

  .animate-fade-in-up {
    animation: fadeInUp 0.5s ease-out;
  }

  .animate-fade-in-down {
    animation: fadeInDown 0.5s ease-out;
  }

  .animate-slide-up {
    animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .animate-slide-down {
    animation: slideDown 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .animate-slide-left {
    animation: slideLeft 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .animate-slide-right {
    animation: slideRight 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .animate-scale-in {
    animation: scaleIn 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .animate-gradient {
    background-size: 200% auto;
    animation: gradientShift 3s ease infinite;
  }

  .animate-bounce-subtle {
    animation: bounceSubtle 2s ease-in-out infinite;
  }

  .animate-pulse-slow {
    animation: pulseSlow 3s ease-in-out infinite;
  }

  .animate-shake {
    animation: shake 0.5s cubic-bezier(0.36, 0.07, 0.19, 0.97);
  }

  .animate-wiggle {
    animation: wiggle 1s ease-in-out infinite;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes fadeInDown {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes slideUp {
    from { opacity: 0; transform: translateY(100%); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes slideDown {
    from { opacity: 0; transform: translateY(-100%); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes slideLeft {
    from { opacity: 0; transform: translateX(100%); }
    to { opacity: 1; transform: translateX(0); }
  }

  @keyframes slideRight {
    from { opacity: 0; transform: translateX(-100%); }
    to { opacity: 1; transform: translateX(0); }
  }

  @keyframes scaleIn {
    from { opacity: 0; transform: scale(0.9); }
    to { opacity: 1; transform: scale(1); }
  }

  @keyframes gradientShift {
    0%, 100% { background-position: 0% center; }
    50% { background-position: 100% center; }
  }

  @keyframes bounceSubtle {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-5px); }
  }

  @keyframes pulseSlow {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
  }

  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    75% { transform: translateX(5px); }
  }

  @keyframes wiggle {
    0%, 100% { transform: rotate(0deg); }
    25% { transform: rotate(-3deg); }
    75% { transform: rotate(3deg); }
  }

  /* Animation delays */
  .delay-100 { animation-delay: 100ms; }
  .delay-200 { animation-delay: 200ms; }
  .delay-300 { animation-delay: 300ms; }
  .delay-400 { animation-delay: 400ms; }
  .delay-500 { animation-delay: 500ms; }
  .delay-700 { animation-delay: 700ms; }
  .delay-1000 { animation-delay: 1000ms; }

  /* Animation durations */
  .duration-150 { animation-duration: 150ms; }
  .duration-200 { animation-duration: 200ms; }
  .duration-300 { animation-duration: 300ms; }
  .duration-500 { animation-duration: 500ms; }

  /* ===== SAFE AREA UTILITIES ===== */
  .safe-top { padding-top: var(--safe-area-top); }
  .safe-bottom { padding-bottom: var(--safe-area-bottom); }
  .safe-left { padding-left: var(--safe-area-left); }
  .safe-right { padding-right: var(--safe-area-right); }
  .safe-x { padding-left: var(--safe-area-left); padding-right: var(--safe-area-right); }
  .safe-y { padding-top: var(--safe-area-top); padding-bottom: var(--safe-area-bottom); }
  .safe-all {
    padding-top: var(--safe-area-top);
    padding-bottom: var(--safe-area-bottom);
    padding-left: var(--safe-area-left);
    padding-right: var(--safe-area-right);
  }

  .mt-safe { margin-top: var(--safe-area-top); }
  .mb-safe { margin-bottom: var(--safe-area-bottom); }

  /* ===== TOUCH UTILITIES ===== */
  .touch-target {
    min-height: 44px;
    min-width: 44px;
  }

  .touch-target-lg {
    min-height: 48px;
    min-width: 48px;
  }

  .touch-none { touch-action: none; }
  .touch-pan-x { touch-action: pan-x; }
  .touch-pan-y { touch-action: pan-y; }
  .touch-manipulation { touch-action: manipulation; }

  /* Active state feedback */
  .active-scale {
    @apply transition-transform active:scale-95;
  }

  .active-opacity {
    @apply transition-opacity active:opacity-70;
  }

  .active-press {
    @apply transition-all active:scale-[0.98] active:opacity-90;
  }

  /* ===== SCROLLING UTILITIES ===== */
  .scroll-smooth {
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
  }

  .scroll-snap-x {
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
  }

  .scroll-snap-y {
    scroll-snap-type: y mandatory;
    -webkit-overflow-scrolling: touch;
  }

  .snap-start { scroll-snap-align: start; }
  .snap-center { scroll-snap-align: center; }
  .snap-end { scroll-snap-align: end; }

  .overscroll-none { overscroll-behavior: none; }
  .overscroll-contain { overscroll-behavior: contain; }

  .hide-scrollbar {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  .hide-scrollbar::-webkit-scrollbar {
    display: none;
  }

  /* ===== LAYOUT UTILITIES ===== */
  .min-h-screen-safe {
    min-height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
    min-height: calc(var(--vh, 1vh) * 100 - var(--safe-area-top) - var(--safe-area-bottom));
  }

  .h-screen-safe {
    height: calc(100vh - var(--safe-area-top) - var(--safe-area-bottom));
    height: calc(var(--vh, 1vh) * 100 - var(--safe-area-top) - var(--safe-area-bottom));
  }

  /* Notch-aware padding */
  .px-safe {
    padding-left: max(16px, var(--safe-area-left));
    padding-right: max(16px, var(--safe-area-right));
  }

  /* ===== GLASS MORPHISM ===== */
  .glass {
    background: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
  }

  .glass-dark {
    background: rgba(31, 41, 55, 0.6);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
  }

  .glass-strong {
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
  }

  /* ===== TEXT UTILITIES ===== */
  .text-balance {
    text-wrap: balance;
  }

  .text-pretty {
    text-wrap: pretty;
  }

  .line-clamp-1 {
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* ===== RESPONSIVE UTILITIES ===== */
  /* Mobile scroll fix */
  .mobile-scroll {
    -webkit-overflow-scrolling: touch;
    overflow-y: auto;
  }

  /* Hide on mobile, show on larger screens */
  .mobile-hidden {
    @apply hidden sm:block;
  }

  /* Show on mobile, hide on larger screens */
  .mobile-only {
    @apply block sm:hidden;
  }

  /* Tablet and up */
  .tablet-up {
    @apply hidden md:block;
  }

  /* Mobile and tablet only */
  .touch-device {
    @apply block lg:hidden;
  }

  /* Desktop only */
  .desktop-only {
    @apply hidden lg:block;
  }

  /* ===== INTERACTION UTILITIES ===== */
  .no-select {
    -webkit-user-select: none;
    user-select: none;
  }

  .select-all {
    -webkit-user-select: all;
    user-select: all;
  }

  .pointer-coarse {
    @media (pointer: coarse) {
      display: block;
    }
    @media (pointer: fine) {
      display: none;
    }
  }

  .pointer-fine {
    @media (pointer: coarse) {
      display: none;
    }
    @media (pointer: fine) {
      display: block;
    }
  }
}

/* ===== MOBILE-SPECIFIC MEDIA QUERIES ===== */
@media (max-width: 640px) {
  /* Force larger touch targets on mobile */
  button:not(.compact),
  a:not(.compact),
  [role="button"]:not(.compact) {
    min-height: 44px;
  }

  /* Ensure inputs are large enough */
  input, textarea, select {
    min-height: 48px;
  }

  /* Prevent horizontal overflow */
  body {
    overflow-x: hidden;
  }

  /* Better spacing for mobile */
  .container {
    padding-left: 16px;
    padding-right: 16px;
  }
}

/* Small phones */
@media (max-width: 375px) {
  html {
    font-size: 14px;
  }
}

/* Handle notched devices */
@supports (padding: max(0px)) {
  body {
    padding-left: max(0px, env(safe-area-inset-left));
    padding-right: max(0px, env(safe-area-inset-right));
  }
}

/* Landscape orientation adjustments */
@media (orientation: landscape) and (max-height: 500px) {
  .bottom-nav {
    height: calc(48px + var(--safe-area-bottom));
  }

  .fab {
    bottom: calc(56px + var(--safe-area-bottom));
  }
}

/* Reduce motion for accessibility */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  .glass, .glass-card {
    background: white;
    border: 2px solid currentColor;
  }

  .dark .glass, .dark .glass-card {
    background: #1f2937;
  }
}

/* Print styles */
@media print {
  .bottom-nav, .fab, .no-print {
    display: none !important;
  }

  body {
    background: white !important;
  }
}
